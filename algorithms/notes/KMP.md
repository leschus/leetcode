# å­—ç¬¦ä¸²åŒ¹é…ä¸KMPç®—æ³•

é—®é¢˜æè¿°: ä»ä¸»ä¸²sä¸­å¯»æ‰¾æ¨¡å¼ä¸²tç¬¬ä¸€æ¬¡å‡ºç°çš„ä½ç½®.

## æš´åŠ›åŒ¹é…

```cpp
int Index(string s, string t) {
  int i = 0, j = 0; // ä¸‹æ ‡ä»0å¼€å§‹
  while (i < s.size() && j < t.size()) {
    if (s[i] == t[j]) {
      i++; j++;
    } else {
      i = i - j + 1;
      j = 0;
    }
  }
  if (j == t.size()) {
    return i - t.size();
  } else {
    return -1;
  }
}
```

æš´åŠ›æ¨¡å¼åŒ¹é…ç®—æ³•çš„æ—¶é—´å¤æ‚åº¦ä¸º`O(nm)`, å…¶ä¸­nå’Œmåˆ†åˆ«æ˜¯ä¸»ä¸²så’Œæ¨¡å¼ä¸²tçš„é•¿åº¦.

å¯¹äºæ¨¡å¼ä¸²ä¸º`"aaaab"`, ä¸»ä¸²ä¸º`"aaaaaaaaab"`çš„æƒ…å†µ, æ¯ä¸€è½®æ¯”è¾ƒéƒ½è¦æ¯”åˆ°æ¨¡å¼ä¸²çš„æœ€åä¸€ä¸ªå­—ç¬¦, å³æ¯”è¾ƒ`5`æ¬¡; ä¸€è½®æ¯”è¾ƒæœ€åå‘ç°ä¸åŒ¹é…ä¹‹å, å†æ‰§è¡Œå›æº¯, å…±éœ€å›æº¯`5`è½®; åŠ ä¸Šæœ€å¼€å§‹çš„ä¸€è½®, å…±è®¡`6`è½®. æ€»å…±æ¯”è¾ƒæ¬¡æ•°ä¸º`6 Ã— 5 = 30`æ¬¡.

## æ”¹è¿›çš„æ¨¡å¼åŒ¹é…ç®—æ³•: KMPç®—æ³•

### äº†è§£æ¦‚å¿µ

é¦–å…ˆç†è§£å­—ç¬¦ä¸²ä¸­çš„ä¸‰ä¸ªæ¦‚å¿µ:
* **å‰ç¼€**: å­—ç¬¦ä¸²çš„ä»»æ„å¤´éƒ¨å­ä¸²(ä¸åŒ…æ‹¬å­—ç¬¦ä¸²æœ¬èº«);
* **åç¼€**: å­—ç¬¦ä¸²çš„ä»»æ„å°¾éƒ¨å­ä¸²(ä¸åŒ…æ‹¬å­—ç¬¦ä¸²æœ¬èº«);
* **æœ€é•¿å…¬å…±å‰åç¼€**: ç”±å­—ç¬¦ä¸²çš„å‰ç¼€é›†åˆå’Œåç¼€é›†åˆä¸­çš„å…¬å…±å…ƒç´ æ‰€ç»„æˆçš„å­ä¸²é›†åˆä¸­, é•¿åº¦æœ€å¤§çš„é‚£ä¸ªå­ä¸²;

ä¾‹å¦‚, å­—ç¬¦ä¸²`"ababa"`çš„å‰ç¼€é›†åˆä¸º: `{"a", "ab", "aba", "abab"}`, åç¼€é›†åˆä¸º`{"a", "ba", "aba", "baba"}`, ä¸¤ä¸ªé›†åˆçš„å…¬å…±å…ƒç´ æœ‰`"a"`å’Œ`"aba"`. ä»è€Œå­—ç¬¦ä¸²çš„æœ€é•¿å…¬å…±å‰åç¼€ä¸º`"aba"`.

ä¸€ä¸ªé•¿åº¦ä¸º`m`çš„æ¨¡å¼ä¸², å…±æœ‰`m`ä¸ªå¤´éƒ¨å­ä¸². è¿™äº›å¤´éƒ¨å­ä¸²çš„æœ€é•¿å…¬å…±å‰åç¼€çš„é•¿åº¦è¢«ç§°ä½œ`éƒ¨åˆ†åŒ¹é…å€¼(Partial Match Value)`.

ä»¥æ¨¡å¼ä¸²`"ababa"`ä¸ºä¾‹:

* é•¿åº¦ä¸º1çš„å¤´éƒ¨å­ä¸²ä¸º`"a"`, å…¶æœ€é•¿å…¬å…±å‰åç¼€ä¸º`""`, å³PMå€¼ä¸º0.
* é•¿åº¦ä¸º2çš„å¤´éƒ¨å­ä¸²ä¸º`"ab"`, å…¶æœ€é•¿å…¬å…±å‰åç¼€ä¹Ÿä¸º`""`, å³PMå€¼ä¸º0.
* é•¿åº¦ä¸º3çš„å¤´éƒ¨å­ä¸²ä¸º`"aba"`, å…¶æœ€é•¿å…¬å…±å‰åç¼€ä¸º`"a"`, å³PMå€¼ä¸º1.
* é•¿åº¦ä¸º4çš„å¤´éƒ¨å­ä¸²ä¸º`"abab"`, å…¶æœ€é•¿å…¬å…±å‰åç¼€ä¸º`"ab"`, å³PMå€¼ä¸º2.
* é•¿åº¦ä¸º5çš„å¤´éƒ¨å­ä¸²ä¸º`"ababa"`, å…¶æœ€é•¿å…¬å…±å‰åç¼€ä¸º`"aba"`, å³PMå€¼ä¸º3.

æ ¹æ®ä¸Šè¿°5ä¸ªéƒ¨åˆ†åŒ¹é…å€¼å¯ä»¥å¾—åˆ°ä¸€å¼ æ¨¡å¼ä¸²`"ababa"`çš„éƒ¨åˆ†åŒ¹é…å€¼è¡¨:

| ç¼–å· | 0 | 1 | 2 | 3 | 4 |
| ---- |---|---|---|---|---|
| å­—ç¬¦ | a | b | a | b | a |
| PMå€¼ | 0 | 0 | 1 | 2 | 3 |

å½“ä¸»ä¸²ä¸º`"ababcababa"`æ—¶, ç¬¬ä¸€è½®æ¯”å¯¹ä¼šå‘ç°ä¸»ä¸²ä¸­çš„`'c'`å’Œæ¨¡å¼ä¸²ä¸­çš„`'a'`ä¸åŒ¹é…:


| ä¸»ä¸² | a | b | a | b | c | a | b | a | b | a |
|:----:|---|---|---|---|---|---|---|---|---|---|
|æ¨¡å¼ä¸²| aâœ”ï¸ | bâœ”ï¸ | aâœ”ï¸ | bâœ”ï¸ | aâŒ |

æŒ‰ç…§æš´åŠ›åŒ¹é…ç®—æ³•, è¿™å°†å¯¼è‡´ç¬¬äºŒè½®æ¨¡å¼ä¸²å°†å³ç§»ä¸€ä¸ªå•ä½é‡æ–°ä¸ä¸»ä¸²å¯¹åº”ä½ç½®å…ƒç´ è¿›è¡Œæ¯”å¯¹.

ç”±äºç¬¬ä¸€è½®æ¯”å¯¹ä¸­, å‰å››ä¸ªå…ƒç´ å‡æ˜¯åŒ¹é…çš„, å³`"abab"`, ä»è€Œç¬¬äºŒè½®æ¯”å¯¹é¦–å…ˆå¾—è¦æ±‚`"abab"`çš„é•¿åº¦ä¸º3çš„å°¾éƒ¨å­ä¸²`"bab"`åŠ¡å¿…ä¸å…¶é•¿åº¦ä¸º3çš„å°¾éƒ¨é¦–éƒ¨å­ä¸²`"aba"`åŒ¹é…. æ˜¾ç„¶, è¿™æ˜¯ä¸è¢«æ»¡è¶³çš„. æ ¹æ®éƒ¨åˆ†åŒ¹é…å€¼è¡¨ä¹Ÿå¯çœ‹å‡º: `"abab"`å¯¹åº”çš„PMå€¼åªæœ‰2, å› è€Œä¸å­˜åœ¨é•¿åº¦ä¸º3çš„å…¬å…±å‰åç¼€.

è¿™è¯´æ˜, æš´åŠ›æ±‚è§£ç®—æ³•çš„ç¬¬äºŒè½®æ¯”å¯¹å…¶å®æ˜¯å¤šä½™çš„. é‚£ä¹ˆ, å¯å¦æ¶ˆé™¤è¿™è½®å¤šä½™çš„æ¯”å¯¹å‘¢?

ç­”æ¡ˆæ˜¯: å¯ä»¥.

è¿™ä¹Ÿæ­£æ˜¯KMPç®—æ³•æ€è·¯çš„ç”±æ¥.

ä¸Šè¿°ä¾‹å­ä¸­, æˆ‘ä»¬åˆ†æå¾—åˆ°ä¸‹ä¸€è½®(ç¬¬äºŒè½®)æ¯”å¯¹å¿…ç„¶å¤±è´¥çš„ç»“è®º, ä»…ä»…å€ŸåŠ©äº†ä¸¤æ ·å‰æ:
1. æœ¬è½®æ¯”å¯¹çš„ç»“æœ. å³æœ¬è½®(ç¬¬ä¸€è½®)æ¯”å¯¹è™½ç„¶å¤±è´¥, ä½†å®ƒæˆåŠŸåŒ¹é…äº†æ¨¡å¼ä¸²çš„å‰å››ä¸ªå­—ç¬¦, ç”±æ­¤æ„æˆçš„æ¨¡å¼ä¸²çš„å¤´éƒ¨å­ä¸²ä¸º`"abab"`;
2. æ¨¡å¼ä¸²çš„éƒ¨åˆ†åŒ¹é…å€¼è¡¨. ä»è¡¨ä¸­å¾—å‡ºæ¨¡å¼ä¸²çš„é•¿åº¦ä¸º4çš„å¤´éƒ¨å­ä¸²çš„PMå€¼ä¸º2. è€Œä¸‹ä¸€è½®(ç¬¬äºŒè½®)æ¨¡å¼ä¸²è‹¥å³ç§»ä¸€ä½å°†è¦æ±‚æ¨¡å¼ä¸²çš„é•¿åº¦ä¸º4çš„å¤´éƒ¨å­ä¸²å…·æœ‰é•¿åº¦ä¸º3çš„å…¬å…±å‰åç¼€, è¯¥è¦æ±‚æ— æ³•è¢«æ»¡è¶³.

å€ŸåŠ©åŒæ ·çš„æ€è·¯, æˆ‘ä»¬å¯ä»¥è®¡ç®—å‡ºä¸‹ä¸€è½®æ¨¡å¼ä¸²åº”å½“å³ç§»å¤šå°‘ä¸ªå•ä½æ‰åˆé€‚. å…ˆç»™å‡ºå…¬å¼:

$$ ç§»åŠ¨ä½æ•° = æœ¬è½®æˆåŠŸåŒ¹é…çš„å­—ç¬¦æ•° - å¯¹åº”çš„PMå€¼ $$

(å…¬å¼è§£é‡Š: ğŸ³ï¸)

å› æ­¤, ä¸Šä¾‹ä¸­è¿›å…¥ç¬¬äºŒè½®ä¹‹å‰æ¨¡å¼ä¸²åº”å½“å³ç§»çš„ä½æ•°ä¸º: $4-2=2$.

ä»è€Œç¬¬äºŒè½®çš„æ¯”å¯¹æƒ…å†µä¸º:

| ä¸»ä¸² | a | b | a | b | c | a | b | a | b | a |
|:----:|---|---|---|---|---|---|---|---|---|---|
|æ¨¡å¼ä¸²|   |   | aâœ”ï¸ | bâœ”ï¸ | aâŒ | b | c |

è¿›å…¥ç¬¬ä¸‰è½®ä¹‹å‰æ¨¡å¼ä¸²åº”å½“å³ç§»ä½æ•°ä¸º: $2-0=2$.

ä»è€Œç¬¬ä¸‰è½®çš„æ¯”å¯¹æƒ…å†µä¸º:

| ä¸»ä¸² | a | b | a | b | c | a | b | a | b | a |
|:----:|---|---|---|---|---|---|---|---|---|---|
|æ¨¡å¼ä¸²|   |   |   |  | aâŒ | b | a | b | a |

è¿›å…¥ç¬¬å››è½®ä¹‹å‰æ¨¡å¼ä¸²åº”å½“å³ç§»ä½æ•°ä¸º: $0-(-1)=1$

æ³¨æ„âš ï¸: æŸä¸€è½®æˆåŠŸåŒ¹é…çš„å­—ç¬¦æ•°ä¸º0æ—¶, å…¶å¯¹åº”çš„PMå€¼åº”å½“æ˜¯-1 (æ­¤æ¡æ²¡æœ‰åœ¨éƒ¨åˆ†åŒ¹é…å€¼è¡¨ä¸­åˆ—å‡º).

ä»è€Œç¬¬å››è½®çš„æ¯”å¯¹æƒ…å†µä¸º:

| ä¸»ä¸² | a | b | a | b | c | a | b | a | b | a |
|:----:|---|---|---|---|---|---|---|---|---|---|
|æ¨¡å¼ä¸²|   |   |   |  |  | aâœ”ï¸ | bâœ”ï¸ | aâœ”ï¸ | bâœ”ï¸ | aâœ”ï¸ |

å³, ç¬¬å››è½®æ¯”å¯¹æ¨¡å¼ä¸²åŒ¹é…æˆåŠŸ.

### å®ç°KMPç®—æ³•

å°†éƒ¨åˆ†åŒ¹é…å€¼è¡¨ç”¨æ•°ç»„PMå­˜å‚¨, ä¸‹æ ‡ä»0å¼€å§‹. åˆ™`PM[i]`è¡¨ç¤ºæŸä¸€è½®æˆåŠŸåŒ¹é…`i+1`ä¸ªå­—ç¬¦æ—¶å¯¹åº”çš„PMå€¼.

ä»¥æš´åŠ›æ±‚è§£ç®—æ³•ä»£ç ä¸ºåŸºç¡€, æ¯ä¸€è½®æ¯”å¯¹åˆ°å¤±é…çš„æƒ…å½¢å‡ºç°æ—¶ç®—ä½œè¯¥è½®æ¯”å¯¹ç»“æŸ, åˆ™è¯¥è½®çš„æˆåŠŸåŒ¹é…å­—ç¬¦æ•°å¯ä»¥ç”¨`j`è¡¨ç¤º, å¯¹åº”çš„PMå€¼ä¸º`PM[j-1]`.

ç”±æ­¤, ä¸‹ä¸€è½®æ¯”å¯¹å¼€å§‹å‰æ¨¡å¼ä¸²çš„å³ç§»ä½æ•°`move`è®¡ç®—å¼ä¸º:
$$ move = j-PM[j-1]$$

ä¸ºäº†é¿å…`j`ç­‰äº0æ—¶, `PM[-1]`éæ³•, å¯å°†PMè¡¨å…ƒç´ é›†ä½“å³ç§»ä¸€ä½, å¹¶åœ¨ä¸‹æ ‡0å¤„å¡«å…¥-1. è¿™è¡¨ç¤ºæŸä¸€è½®æˆåŠŸåŒ¹é…å­—ç¬¦ä¸ªæ•°ä¸º0æ—¶, åº”å½“å°†æ¨¡å¼ä¸²å³ç§»1ä½ (å‚è€ƒä¸ŠèŠ‚ç¤ºä¾‹ä¸­çš„ç¬¬å››è½®). å°†ç»è¿‡è¿™ä¸€å¤„ç†çš„PMæ•°ç»„æ¢ä¸ªç§°å‘¼, å«ä½œ: nextæ•°ç»„.

ä¾‹å¦‚, é’ˆå¯¹æ¨¡å¼ä¸²`"ababa"`, å…¶nextæ•°ç»„å†…å®¹ä¸º:

| index | 0 | 1 | 2 | 3 | 4 |
| :----: |---|---|---|---|---|
| next | -1 | 0 | 0 | 1 | 2 |

è®¡ç®—å¼æ›´æ–°ä¸º:
$$move=j-next[j]$$

è¿›ä¸€æ­¥åœ°, "æ¨¡å¼ä¸²å³ç§»"è¿™ä¸€æ“ä½œä½“ç°åœ¨ä»£ç ä¸Šå°±æ˜¯æ›´æ–°`j`çš„å€¼. å…·ä½“åœ°è¯´, æ˜¯å°†`j`å€¼æ›´æ–°ä¸º`j - move`.

ä»è€Œ, ä¸€è½®ç»“æŸå, `j`å€¼æ›´æ–°å…¬å¼ä¸º:
$$j=j-move=j-(j-next[j])=next[j]$$

#### ç”Ÿæˆnextæ•°ç»„:

```cpp
// æ ¹æ®æ¨¡å¼ä¸²tç”Ÿæˆnextæ•°ç»„
vector<int> generate_next(string t) {
  vector<int> next(t.size());
  next[0] = -1;
  int i = 0, j = -1;
  while (i < t.size()) {
    if (j == -1 || t[i] == t[j]) {
      i++; j++;
      next[i] = j;
    } else {
      j = next[j];
    }
  }
  return next;
}
```
æ€è·¯è§£æ: ğŸ³ï¸

#### åŸºäºnextæ•°ç»„å®ç°KMPç®—æ³•:
```cpp
int Index_KMP(string s, string t) {
  vector<int> next = generate_next(t);
  for (int x: next) cout << x << " ";
  cout << endl;
  int i = -1, j = -1;
  int len1 = s.size(), len2 = t.size();
  // æ³¨æ„: ç›´æ¥å°†å˜é‡iå’Œs.size()æ¯”è¾ƒä¼šæœ‰é—®é¢˜, å› ä¸ºs.size()çš„è¿”å›ç±»å‹size_tæ²¡æœ‰
  // ç¬¦å·, å› æ­¤å°†intå‹çš„-1å’Œsize_tç±»å‹å€¼è¿›è¡Œæ¯”è¾ƒ, å°†å‘ç”Ÿéšå¼å‘ä¸Šç±»å‹è½¬æ¢, å¯¼è‡´
  // å‚ä¸æ¯”è¾ƒçš„iå€¼å®é™…ä¸ºUINT_MAX. ==>ç”±æ­¤å¯¼è‡´while()å¾ªç¯æ ¹æœ¬å°±ä¸ä¼šè¿›å…¥!!
  while (i < len1 && j < len2) {
    if (j == -1 || s[i] == t[j]) {
      i++; j++;
    } else {
      j = next[j];
    }
  }
  if (j == len2) {
    return i - len2;
  } else {
    return -1;
  }
}
```
æ€è·¯è§£æ: ğŸ³ï¸